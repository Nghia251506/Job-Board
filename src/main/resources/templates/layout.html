<!-- layout.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi" th:fragment="layout(pageTitle, content)">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <title th:text="${pageTitle} ?: 'MyWebApp'">MyWebApp</title>
    <style>
        html, body { height: 100%; margin: 0; }

        .page-wrap { min-height: 100vh}

        .main { display: flex; align-items: stretch; min-height: 0; }

        .sidebar { width: 240px; flex: 0 0 240px; min-height: 100vh; position: sticky; top: 0; }

        .content { flex: 1 1 auto; overflow: auto; }
        .footer { margin-top: auto; }
        :root{
            --sb-width: 240px;
            --sb-collapsed: 72px;
            --sb-bg: linear-gradient(180deg, #0f172a 0%, #111827 100%);
            --sb-hover: rgba(255,255,255,.08);
            --sb-active: rgba(255,255,255,.14);
        }

        .sidebar{
            width: var(--sb-width);
            min-width: var(--sb-width);
            height: 100vh;
            position: sticky;
            top: 0;
            background: var(--sb-bg) !important;
            box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, 0 10px 30px rgba(0,0,0,.25);
            overflow: hidden;
            transition: width .25s ease, min-width .25s ease, box-shadow .25s ease;
        }

        .sidebar.collapsed{
            width: var(--sb-collapsed);
            min-width: var(--sb-collapsed);
        }

        .sidebar .label{
            transition: opacity .2s ease, transform .2s ease;
            white-space: nowrap;
        }
        .sidebar.collapsed .label{
            opacity: 0;
            transform: translateX(-8px);
            pointer-events: none;
        }

        .sidebar .nav-link{
            border-radius: .75rem;
            padding: .6rem .75rem;
            transition: background-color .15s ease, transform .12s ease, box-shadow .15s ease;
        }
        .sidebar .nav-link:hover{
            background-color: var(--sb-hover);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0,0,0,.25);
        }
        .sidebar .nav-link.active,
        .sidebar .nav-link[aria-current="page"]{
            background-color: var(--sb-active);
        }

        .sidebar .nav-link i,
        .sidebar .brand-icon{
            width: 20px;
            text-align: center;
        }

        @media (prefers-reduced-motion: reduce){
            .sidebar, .sidebar .label, .sidebar .nav-link{
                transition: none !important;
            }
        }

        .body-with-sidebar .content-wrap{
            margin-left: var(--sb-width);
            transition: margin-left .25s ease;
        }
        .body-with-sidebar.sidebar-collapsed .content-wrap{
            margin-left: var(--sb-collapsed);
        }
    </style>
</head>
<body>
<div class="page-wrap ">
    <div class="main d-flex">
        <!-- sidebar trái -->
        <div th:replace="~{fragments/common :: sidebar}"></div>

        <!-- content phải -->
        <main class="content p-3">
            <!-- chỗ inject nội dung trang con -->
            <div th:replace="${content}"></div>
        </main>
    </div>

    <!-- footer cuối trang -->
    <div th:replace="~{fragments/common :: footer}"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (function(){
        const key = 'sidebar-collapsed';
        const sb = document.getElementById('sidebar');
        const btn = document.getElementById('sbToggle');
        const body = document.body;

        body.classList.add('body-with-sidebar');

        if(localStorage.getItem(key) === '1'){
            sb.classList.add('collapsed');
            body.classList.add('sidebar-collapsed');
        }

        btn?.addEventListener('click', function(){
            sb.classList.toggle('collapsed');
            body.classList.toggle('sidebar-collapsed');
            localStorage.setItem(key, sb.classList.contains('collapsed') ? '1' : '0');
        });
    })();
</script>
</body>
</html>
