<!-- src/main/resources/templates/jobposts.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<body>
<div th:block th:replace="~{layout :: layout(
      pageTitle=${'Danh sách Job Posts'},
      content=~{::content}
)}">

    <section th:fragment="content">
        <div class="card">
            <div class="card-header">
                <h1>Danh sách bài tuyển dụng</h1>
                <div class="d-flex align-items-center gap-2">
                    <a th:href="@{/jobposts/add}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Thêm Job Post
                    </a>

                    <!-- Bộ lọc / tìm kiếm -->
                    <form class="ms-auto w-100" th:action="@{/jobposts}" method="get" style="max-width:760px;">
                        <div class="row g-2">
                            <div class="col-md-4">
                                <input type="text" class="form-control" name="q" th:value="${q}"
                                       placeholder="Tìm theo tiêu đề, mô tả, địa điểm">
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" name="companyId">
                                    <option value="" th:selected="${companyId == null}">-- Tất cả công ty --</option>
                                    <option th:each="c : ${companies}"
                                            th:value="${c.id}"
                                            th:text="${c.name}"
                                            th:selected="${companyId != null and companyId == c.id}"></option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" name="jobType">
                                    <option value="" th:selected="${jobType == null}">-- Tất cả hình thức --</option>
                                    <option value="FULL_TIME"  th:selected="${jobType == 'FULL_TIME'}">Full-time</option>
                                    <option value="PART_TIME"  th:selected="${jobType == 'PART_TIME'}">Part-time</option>
                                    <option value="REMOTE"     th:selected="${jobType == 'REMOTE'}">Remote</option>
                                    <option value="INTERNSHIP" th:selected="${jobType == 'INTERNSHIP'}">Internship</option>
                                </select>
                            </div>
                            <div class="col-md-2 d-flex gap-2">
                                <button class="btn btn-primary w-100" type="submit">Lọc</button>
                                <a class="btn btn-outline-secondary w-100" th:href="@{/jobposts}">Xóa</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card-body">

                <!-- EMPTY STATE -->
                <div th:if="${jobposts == null
                     or (jobposts instanceof T(org.springframework.data.domain.Page)
                         ? jobposts.totalElements == 0
                         : #lists.isEmpty(jobposts))}"
                     class="text-center py-5">
                    <img th:src="@{/img/sad.png}" alt="No data" class="mb-3" style="width:120px;opacity:.8;">
                    <p class="text-muted mb-0">Chưa có job post nào</p>
                </div>

                <!-- TABLE -->
                <div th:unless="${jobposts == null
                         or (jobposts instanceof T(org.springframework.data.domain.Page)
                             ? jobposts.totalElements == 0
                             : #lists.isEmpty(jobposts))}">
                    <div class="table-responsive">
                        <table class="table table-striped align-middle">
                            <thead>
                            <tr>
                                <th style="width:64px;">#</th>
                                <th>Tiêu đề</th>
                                <th>Công ty</th>
                                <th>Địa điểm</th>
                                <th>Hình thức</th>
                                <th>Lương</th>
                                <th>Ngày đăng</th>
                                <th style="width:150px;">Thao tác</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="p, stat : ${jobposts}">
                                <td th:text="${(jobposts instanceof T(org.springframework.data.domain.Page))
                                ? (jobposts.number * jobposts.size + stat.index + 1)
                                : (stat.index + 1)}">1</td>
                                <td><a th:href="@{/jobposts/{id}(id=${p.id})}" th:text="${p.title}">Title</a></td>
                                <td th:text="${p.company != null ? p.company.name : '—'}">Công ty</td>
                                <td th:text="${p.location}">Hà Nội</td>
                                <td th:text="${p.jobType}">FULL_TIME</td>
                                <td th:text="${p.salary}">20–35 triệu</td>
                                <td th:date="${#temporals.format(p.postedDate, 'dd/MM/yyyy HH:mm')}">01/11/2025 10:00</td>
                                <td class="d-flex gap-1">
                                    <a th:href="@{/jobposts/edit/{id}(id=${p.id})}" class="btn btn-warning btn-sm">Sửa</a>
                                    <a th:href="@{/jobposts/delete/{id}(id=${p.id})}"
                                       class="btn btn-danger btn-sm"
                                       onclick="return confirm('Xóa job post này?')">Xóa</a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <nav th:if="${jobposts instanceof T(org.springframework.data.domain.Page) and jobposts.totalPages > 1}">
                        <ul class="pagination mb-0">
                            <li class="page-item" th:classappend="${jobposts.first} ? ' disabled'">
                                <a class="page-link"
                                   th:href="@{/jobposts(page=${jobposts.number-1}, size=${jobposts.size}, q=${q}, companyId=${companyId}, jobType=${jobType})}">
                                    &laquo;
                                </a>
                            </li>

                            <li class="page-item"
                                th:each="i : ${#numbers.sequence(0, jobposts.totalPages-1)}"
                                th:classappend="${i == jobposts.number} ? ' active'">
                                <a class="page-link"
                                   th:text="${i + 1}"
                                   th:href="@{/jobposts(page=${i}, size=${jobposts.size}, q=${q}, companyId=${companyId}, jobType=${jobType})}">1</a>
                            </li>

                            <li class="page-item" th:classappend="${jobposts.last} ? ' disabled'">
                                <a class="page-link"
                                   th:href="@{/jobposts(page=${jobposts.number+1}, size=${jobposts.size}, q=${q}, companyId=${companyId}, jobType=${jobType})}">
                                    &raquo;
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>

            </div>
        </div>
    </section>

</div>
</body>
</html>
